                                                            (g.records[0]?.["Com_Comercial"] || "").toLowerCase().includes(lowerTerm);
                                                        if (!matches) return false;
                                                    }

                                                    const status = (g.records[0]?.["Com_Estado_Interno"] || g.status || "").toUpperCase();
                                                    // 2. Excluir Cancelados/Anulados
                                                    if (status.includes("ANUL") || status.includes("CANC")) return false;

                                                    // 3. Excluir Pasados
                                                    const today = new Date().toISOString().split('T')[0];
                                                    if (g.departure < today) return false;

                                                    // 4. Filtro Hotel
                                                    if (filterDirHotel) {
                                                        const raw = g.records[0]?.["Hotel_Asignado"] || g.records[0]?.["Hotel"];
                                                        const hotel = raw && raw.toLowerCase().includes('guadiana') ? 'Sercotel Guadiana' : raw;
                                                        if (hotel !== filterDirHotel) return false;
                                                    }

                                                    // 5. Filtro Comercial (case-insensitive)
                                                    if (filterDirCommercial) {
                                                        const rawC = (g.records[0]?.["Com_Comercial"] || "").trim().toUpperCase();
                                                        if (rawC !== filterDirCommercial.toUpperCase()) return false;
                                                    }

